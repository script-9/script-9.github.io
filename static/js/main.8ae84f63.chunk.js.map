{"version":3,"sources":["images/logo.png","images/tanks.gif","images/8bomb.gif","images/dungeon.gif","images/porklike.gif","images/supplies.gif","images/loshermanosbros-lite.gif","images/livecoding480.gif","images/slider480.gif","images/pauserewind.gif","images/toggle.gif","images/spritedemo.gif","images/mapdemo.gif","images/musicdemo.gif","components/NavLink.js","utils/demoCode.js","components/Nav.js","components/Home.js","utils/getLintErrors.js","components/Editor.js","components/Canvas.js","utils/getErrorLocation.js","components/Output.js","components/Code.js","components/Run.js","utils/network.js","components/Oauth.js","App.js","serviceWorker.js","index.js"],"names":["module","exports","NavLink","props","getProps","location","href","origin","pathname","search","join","endsWith","className","demoCode","Nav","cassette","setCassette","to","gist","id","onClick","contents","code","Home","version","timestamp","src","logo","alt","loshermanosbrosgif","bombgif","dungeongif","tanksgif","suppliesgif","porklikegif","livecoding480","slider480","pauserewind","toggle","spritedemo","mapdemo","musicdemo","parseOptions","ecmaVersion","sourceType","locations","getLintErrors","text","errors","acorn","error","push","from","line","loc","ch","column","raisedAt","message","replace","severity","log","Editor","codeMirrorDivRef","useRef","codeMirrorRef","cassetteCodeRef","useEffect","window","CodeMirror","registerHelper","current","mode","theme","lint","lineNumbers","tabSize","cursorBlinkRate","scrollbarStyle","on","cm","getValue","cassetteCode","setValue","ref","Canvas","forwardRef","canvasRef","_pixelData","ImageData","useImperativeHandle","draw","_pixelBytes","data","set","getContext","putImageData","width","height","browser","detect","regexLookup","chrome","getErrorLocation","regex","name","stack","match","exec","Output","workerRef","pixelBytesRef","intervalRef","messageReceivedDateRef","useState","codeError","setCodeError","isCodeTimedOut","setIsCodeTimedOut","initWorker","useCallback","console","stop","Worker","onmessage","e","Date","now","messageType","payload","interval","terminate","length","postMessage","Code","Run","fetchGithubAppAccessToken","a","fetch","process","method","body","JSON","stringify","response","status","json","Error","statusText","assembleGistPayload","public","description","files","content","fetchFavicon","ok","fetchGist","gistId","url","editGist","token","options","headers","Authorization","createGist","saveGist","Oauth","setCommentsToken","URLSearchParams","get","network","then","access_token","navigate","catch","App","path","isLocalhost","Boolean","hostname","registerValidSW","swUrl","config","navigator","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","state","controller","onUpdate","onSuccess","rootElement","document","getElementById","hasChildNodes","hydrate","render","URL","addEventListener","contentType","indexOf","ready","unregister","reload","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.8ae84f63.chunk.js","sourcesContent":["module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAlAAAAAoCAIAAAC+blOXAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpBQTRCNkU3RDBEOTExMUU5Qjk3MkFERTEyRkI4RjBCQSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpBQTRCNkU3RTBEOTExMUU5Qjk3MkFERTEyRkI4RjBCQSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkFBNEI2RTdCMEQ5MTExRTlCOTcyQURFMTJGQjhGMEJBIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkFBNEI2RTdDMEQ5MTExRTlCOTcyQURFMTJGQjhGMEJBIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+HvluxAAAAUhJREFUeNrs3TFOQkEQgGEwL7RIaAxHsJDiWXsZzsVJ6Kx5hRYcwdAQpDKhorGE4pFZ1sHvKzGZLFL82WKyw5/NahBh8rY4+/n+fWn+Hc8vLfv5a4n6v3VdFzJn87kPmbPdHUPmrL9izvNx+A6ZMx8/hsx5nU1C5jxNRyFznl9iztO2bcichwEA/AOCB4DgAYDgAYDgAYDgAYDgAUAJzaU/lN5bqjW/735S3zlR3yv7+UsrvXcIuOEBgOABgOABgOABgOABgOABgOABwK+Le3hR+161ZN8zy7JPVuu9Ovt2gBseAAgeAIIHAIIHAIIHAIIHAIIHADfS3Ov+U/Z34LK/S/fXfl8ANzwABA8ABA8ABA8ABA8ABA8ABA8ArtTU2lvK8t5e33Nmf4cvC/t2gBseAAgeAIIHAIIHAIIHAIIHAIIHADdyEmAARD5eRI/K+WsAAAAASUVORK5CYII=\"","module.exports = __webpack_public_path__ + \"static/media/tanks.5da68a3d.gif\";","module.exports = __webpack_public_path__ + \"static/media/8bomb.5025e955.gif\";","module.exports = __webpack_public_path__ + \"static/media/dungeon.98e9f8a6.gif\";","module.exports = __webpack_public_path__ + \"static/media/porklike.5577896b.gif\";","module.exports = __webpack_public_path__ + \"static/media/supplies.c4b71463.gif\";","module.exports = __webpack_public_path__ + \"static/media/loshermanosbros-lite.c3b13663.gif\";","module.exports = __webpack_public_path__ + \"static/media/livecoding480.20d1866a.gif\";","module.exports = __webpack_public_path__ + \"static/media/slider480.dc4d8c4b.gif\";","module.exports = __webpack_public_path__ + \"static/media/pauserewind.741e69fa.gif\";","module.exports = __webpack_public_path__ + \"static/media/toggle.4ab6d6b6.gif\";","module.exports = __webpack_public_path__ + \"static/media/spritedemo.76159464.gif\";","module.exports = __webpack_public_path__ + \"static/media/mapdemo.23680514.gif\";","module.exports = __webpack_public_path__ + \"static/media/musicdemo.c1b0f3bd.gif\";","import React from 'react'\nimport { Link } from '@reach/router'\n\nconst NavLink = props => (\n  <Link\n    {...props}\n    getProps={({ location, href }) => {\n      const { origin, pathname, search } = location\n      return [origin, pathname, search].join('').endsWith(href)\n        ? { className: 'active' }\n        : null\n    }}\n  />\n)\n\nexport default NavLink\n","const demoCode = () => `draw = () => {\n  clear(6)\n  print(60, 62, Date.now(), 0)\n}`\n\nexport default demoCode\n","import React from 'react'\nimport NavLink from './NavLink'\nimport demoCode from './../utils/demoCode'\n// import GistFetcher from './GistFetcher'\n// import getIdFromLocation from './../utils/getIdFromLocation'\n\n// import * as idb from 'idb-keyval'\n// import uuid from './../utils/uuid'\n// import network from './../utils/network'\n// import usePrevious from './../utils/usePrevious'\n// import isCassetteDirty from './../utils/isCassetteDirty'\n\nconst Nav = props => {\n  const { cassette, setCassette } = props\n  // const { location, cassette, setCassette } = props\n  // const [, setIsDirty] = useState(false)\n\n  // useEffect(\n  //   () => {\n  //     if (cassette?.gist) {\n  //       navigate(`${path}?id=${cassette.gist.id}`)\n  //     } else {\n  //       navigate(`${path}`)\n  //     }\n  //   },\n  //   [cassette, path],\n  // )\n\n  // useEffect(\n  //   () => {\n  //     isCassetteDirty(cassette).then(setIsDirty)\n  //   },\n  //   [cassette],\n  // )\n\n  // const handleNew = () => {\n  //   setCassette(null)\n  // }\n\n  // const handleSave = async () => {\n  //   try {\n  //     // If save goes through:\n  //     // - remove cassette from idb\n  //     // - remove its idbId\n  //     const gist = await network.saveGist({ cassette, token })\n  //     if (cassette.idbId) {\n  //       await idb.del(cassette.idbId)\n  //     }\n  //     const updatedCassette = {\n  //       ...cassette,\n  //       gist,\n  //       idbId: null,\n  //     }\n  //     setCassette(updatedCassette)\n  //   } catch (error) {\n  //     // If save fails:\n  //     // - give cassette an idbId\n  //     // - remove the gist part, but keep gistId\n  //     // - put cassette in idb\n  //     const updatedCassette = {\n  //       ...cassette,\n  //       idbUpdatedAt: Date.now(),\n  //       idbId: cassette.idbId || uuid(),\n  //       gist: null,\n  //       gistId: (cassette.gist?.id) || null,\n  //     }\n  //     await idb.set(updatedCassette.idbId, updatedCassette)\n  //     setCassette(updatedCassette)\n  //   }\n  // }\n\n  // const isNew = !cassette || !(cassette.contents?.code)\n  // const canSave = (!isNew && isDirty) || (!isNew && cassette.idbId)\n\n  // const gistId = getIdFromLocation(location)\n\n  return (\n    <nav>\n      {/* <GistFetcher gistId={gistId} setCassette={setCassette} /> */}\n      <div className=\"pages\">\n        <ul>\n          <li>\n            <NavLink to={cassette?.gist ? `/?id=${cassette.gist.id}` : '/'}>\n              SCRIPT-8\n            </NavLink>\n          </li>\n          <li>\n            <NavLink\n              to={cassette?.gist ? `/code?id=${cassette.gist.id}` : '/code'}\n            >\n              Code\n            </NavLink>\n          </li>\n          {/* <li>\n            <NavLink\n              to={\n                cassette && cassette.gist\n                  ? `/shelf?id=${cassette.gist.id}`\n                  : '/shelf'\n              }\n            >\n              Shelf\n            </NavLink>\n          </li> */}\n          <li>\n            <NavLink\n              to={cassette?.gist ? `/run?id=${cassette.gist.id}` : '/run'}\n            >\n              Run\n            </NavLink>\n          </li>\n          <li>\n            <button\n              onClick={() => {\n                setCassette((cassette = {}) => ({\n                  ...cassette,\n                  contents: {\n                    code: demoCode(),\n                  },\n                }))\n              }}\n            >\n              Load test code\n            </button>\n          </li>\n          {/* <li>\n            <a href={`${process.env.REACT_APP_NOW}/api/oauth-authorize`}>\n              comments-login\n            </a>\n          </li> */}\n        </ul>\n      </div>\n      {/* {<div>v{version}</div>} */}\n      {/* <div className=\"buttons\">\n        <ul>\n          {isDirty && <li>*</li>}\n          <li>\n            <button disabled={isNew} onClick={handleNew}>\n              New\n            </button>\n          </li>\n          <li>\n            <button disabled={!canSave} onClick={handleSave}>\n              Save\n            </button>\n          </li>\n        </ul>\n      </div> */}\n    </nav>\n  )\n}\n\nexport default Nav\n","import React from 'react'\nimport Nav from './Nav'\nimport logo from '../images/logo.png'\nimport tanksgif from '../images/tanks.gif'\nimport bombgif from '../images/8bomb.gif'\nimport dungeongif from '../images/dungeon.gif'\nimport porklikegif from '../images/porklike.gif'\nimport suppliesgif from '../images/supplies.gif'\nimport loshermanosbrosgif from '../images/loshermanosbros-lite.gif'\nimport livecoding480 from '../images/livecoding480.gif'\nimport slider480 from '../images/slider480.gif'\nimport pauserewind from '../images/pauserewind.gif'\nimport toggle from '../images/toggle.gif'\nimport spritedemo from '../images/spritedemo.gif'\nimport mapdemo from '../images/mapdemo.gif'\nimport musicdemo from '../images/musicdemo.gif'\n\nconst Home = props => {\n  const { version, timestamp } = props\n\n  return (\n    <div className=\"Home\">\n      <Nav {...props} />\n      <h1>SCRIPT-8</h1>\n      <div className=\"logo-and-timestamp\">\n        <img src={logo} alt=\"SCRIPT-8 logo\" />\n        <span>updated {timestamp}</span>\n        <span>v{version}</span>\n      </div>\n      <p>\n        (NOTICE: You're looking at the beta version. This is where I test new\n        features. Go to <a href=\"https://script-8.github.io\">SCRIPT-8</a> for\n        the full experience.)\n      </p>\n      <p>\n        SCRIPT-8 is a fantasy computer for making, sharing, and playing tiny\n        retro-looking games (called cassettes). It's free, browser-based, and{' '}\n        <a href=\"https://github.com/script-8/script-8.github.io\">open-source</a>\n        . Cassettes are written in JavaScript.\n      </p>\n      <p className=\"thumbnails\">\n        <img src={loshermanosbrosgif} alt=\"Los hermanos bros game gif\" />\n        <img src={bombgif} alt=\"8-bomb game gif\" />\n        <img src={dungeongif} alt=\"dungeon game gif\" />\n        <img src={tanksgif} alt=\"tanks game gif\" />\n        <img src={suppliesgif} alt=\"supplies game gif\" />\n        <img src={porklikegif} alt=\"porklike game gif\" />\n      </p>\n      <p>\n        SCRIPT-8 is designed to encourage play — the kind of wonder-filled play\n        children experience as they explore and learn about the world. In order\n        to support this goal, everything in SCRIPT-8 has immediate feedback. It\n        is what some call a \"livecoding\" environment.\n      </p>\n      <p>It features:</p>\n      <p className=\"feature\">\n        <span>a code editor where the game changes as you type.</span>\n        <img src={livecoding480} alt=\"livecoding\" />\n      </p>\n      <p className=\"feature\">\n        <span>a slider to help you tweak numbers without typing.</span>\n        <img src={slider480} alt=\"slider\" />\n      </p>\n      <p className=\"feature\">\n        <span>a time-traveling tool so you can pause and rewind.</span>\n        <img src={pauserewind} alt=\"pause and rewind\" />\n      </p>\n      <p className=\"feature\">\n        <span>buttons that show a character's past and future paths.</span>\n        <img src={toggle} alt=\"toggle\" />\n      </p>\n      <p className=\"feature\">\n        <span>\n          a sprite editor where the game instantly displays your edits.\n        </span>\n        <img src={spritedemo} alt=\"sprite demo\" />\n      </p>\n      <p className=\"feature\">\n        <span>\n          a map editor where changes alter the game's behavior, in real-time.\n        </span>\n        <img src={mapdemo} alt=\"map demo\" />\n      </p>\n      <p className=\"feature\">\n        <span>\n          a music editor where you create phrases, group them into chains, and\n          turn those into songs.\n        </span>\n        <img src={musicdemo} alt=\"music demo\" />\n      </p>\n      <p>Each cassette is recorded to a URL you can share with anyone.</p>\n      <p>Play cassettes with a keyboard or gamepad.</p>\n      <p>\n        You can inspect any cassette's contents (even if it's not yours), change\n        the code, art, or music, and record it to a different cassette — a new\n        version.\n      </p>\n      <p>\n        SCRIPT-8 is heavily influenced by Bret Victor's ideas (specifically{' '}\n        <a href=\"http://vimeo.com/36579366\">Inventing on principle</a> and{' '}\n        <a className=\"text\" href=\"http://worrydream.com/LearnableProgramming/\">\n          Learnable programming\n        </a>\n        ) and Joseph White's{' '}\n        <a href=\"https://www.lexaloffle.com/pico-8.php\">PICO-8</a>, the best of\n        all fantasy consoles.\n      </p>\n      <p>\n        SCRIPT-8 is written by Gabriel Florit (that's me!) and{' '}\n        <a\n          className=\"text\"\n          href=\"https://github.com/script-8/script-8.github.io/graphs/contributors\"\n        >\n          dedicated contributors\n        </a>\n        . Click{' '}\n        <a href=\"https://twitter.com/gabrielflorit\">\n          https://twitter.com/gabrielflorit\n        </a>{' '}\n        to follow me on twitter. And visit the Github repository,{' '}\n        <a\n          className=\"text\"\n          href=\"https://github.com/script-8/script-8.github.io\"\n        >\n          https://github.com/script-8/script-8.github.io\n        </a>\n        , where you can keep up with new features and the occasional bug fix.\n      </p>\n      <p>\n        If you have any questions, come join us on the{' '}\n        <a href=\"https://discord.gg/HA68FNX\">Fantasy Consoles Discord server</a>\n        , a friendly place to chat about these sophisticated, cutting-edge\n        computers. The server has a dedicated SCRIPT-8 room.\n      </p>\n      <p>\n        SCRIPT-8 nyx8 palette by{' '}\n        <a href=\"https://twitter.com/Xavier_Gd\">Javier Guerrero</a>. Sprites in{' '}\n        <a\n          className=\"text\"\n          href=\"https://script-8.github.io/?id=cd8d6811adb3afb472aaf7505729cf01\"\n        >\n          Los Hermanos Bros.\n        </a>{' '}\n        by <a href=\"https://twitter.com/johanvinet\">Johan Vinet</a>.\n      </p>\n    </div>\n  )\n}\n\nexport default Home\n","import * as acorn from 'acorn'\n\nconst parseOptions = {\n  ecmaVersion: 10,\n  sourceType: 'script',\n  locations: true,\n}\n\nconst getLintErrors = text => {\n  const errors = []\n  try {\n    acorn.parse(text, parseOptions)\n  } catch (error) {\n    errors.push({\n      from: {\n        line: error.loc.line - 1,\n        ch: error.loc.column,\n      },\n      to: {\n        line: error.loc.line - 1,\n        ch: error.raisedAt,\n      },\n      message: error.message.replace(/ \\(\\d+:\\d+\\)$/, ''),\n      severity: 'error',\n    })\n  }\n\n  return errors\n}\n\nexport default getLintErrors\n","import React, { useEffect, useRef } from 'react'\nimport getLintErrors from './../utils/getLintErrors'\n\nconst log = false ? console.log : () => {}\n\nconst Editor = props => {\n  const { cassette, setCassette } = props\n\n  // The CodeMirror DOM node.\n  const codeMirrorDivRef = useRef()\n\n  // The CodeMirror instance.\n  const codeMirrorRef = useRef()\n\n  // The cassette prop, as a mutable Ref. This way we can access the latest\n  // inside our CodeMirror.changes event.\n  const cassetteCodeRef = useRef(cassette?.contents?.code)\n\n  // On mount, set CodeMirror on the DOM node.\n  useEffect(() => {\n    window.CodeMirror.registerHelper('lint', 'javascript', getLintErrors)\n    codeMirrorRef.current = window.CodeMirror(codeMirrorDivRef.current, {\n      mode: 'javascript',\n      theme: 'nyx8',\n      lint: true,\n      lineNumbers: true,\n      tabSize: 2,\n      cursorBlinkRate: 0,\n      scrollbarStyle: null,\n    })\n\n    // When CodeMirror fires a `changes` event,\n    codeMirrorRef.current.on('changes', cm => {\n      // if CodeMirror isn't equal to the mutable cassette Ref,\n      const cmValue = cm.getValue()\n      if (cmValue !== cassetteCodeRef.current) {\n        // call setCassette with CodeMirror.\n        log('setCassette(codeMirror)')\n        setCassette((cassette = {}) => ({\n          ...cassette,\n          contents: {\n            code: cm.getValue(),\n          },\n        }))\n      }\n    })\n  }, [setCassette])\n\n  // When cassette changes:\n  useEffect(() => {\n    // first, set the cassette's code to a mutable Ref.\n    // This way we have access to the latest inside the event handler.\n    cassetteCodeRef.current = cassette?.contents?.code\n\n    // If the cassette and CodeMirror differ,\n    // set cassette on CodeMirror.\n    const cassetteCode = cassette?.contents?.code\n    if (cassetteCode !== codeMirrorRef.current.getValue()) {\n      log('codeMirror.setValue(cassette)')\n      codeMirrorRef.current.setValue(cassetteCode)\n    }\n  }, [cassette])\n\n  return (\n    <div className=\"Editor\">\n      <div ref={codeMirrorDivRef} />\n    </div>\n  )\n}\n\nexport default Editor\n","import React, {\n  useRef,\n  useImperativeHandle,\n  forwardRef,\n  useEffect,\n} from 'react'\n\nconst Canvas = forwardRef((props, ref) => {\n  const canvasRef = useRef()\n  const _pixelData = useRef()\n\n  useEffect(() => {\n    _pixelData.current = new ImageData(128, 128)\n  }, [])\n\n  useImperativeHandle(ref, () => ({\n    draw: _pixelBytes => {\n      _pixelData.current.data.set(_pixelBytes)\n      const ctx = canvasRef.current.getContext('2d')\n      ctx.putImageData(_pixelData.current, 0, 0)\n    },\n  }))\n  return <canvas width={128} height={128} ref={canvasRef} />\n})\n\nexport default Canvas\n","import { detect } from 'detect-browser'\n\nconst browser = detect()\n\nconst regexLookup = {\n  /* Chrome Stack Trace Example:\n\n    ReferenceError: cle is not defined\n        at eval (eval at onmessage (worker.js:40), <anonymous>:11:9)\n        at test (eval at onmessage (worker.js:40), <anonymous>:3:27)\n        at eval (eval at onmessage (worker.js:40), <anonymous>:10:7)\n        at test (eval at onmessage (worker.js:40), <anonymous>:3:27)\n        at eval (eval at onmessage (worker.js:40), <anonymous>:9:5)\n        at test (eval at onmessage (worker.js:40), <anonymous>:3:27)\n        at draw (eval at onmessage (worker.js:40), <anonymous>:8:3)\n        at onmessage (worker.js:50)\n  */\n  chrome: /\\(eval at onmessage .*, <anonymous>:(\\d+):(\\d+)\\)/,\n  /* Firefox Stack Trace Example:\n  */\n  // firefox: /line \\d+ > eval line \\d+ > eval:(\\d+):(\\d+)/,\n  /* Edge Stack Trace Example:\n  */\n  // edge: /\\(eval code:(\\d+):(\\d+)\\)/,\n}\n\nconst getErrorLocation = error => {\n  const regex = regexLookup[browser.name]\n  if (regex && error.stack) {\n    const match = regex.exec(error.stack)\n    if (match) {\n      return {\n        line: match[1],\n        column: match[2],\n      }\n    }\n  } else if (browser.name === 'safari') {\n    return {\n      line: error.line,\n      column: error.column,\n    }\n  }\n}\n\nexport default getErrorLocation\n","import React, { useRef, useEffect, useState, useCallback } from 'react'\nimport { interval } from 'd3-timer'\nimport Canvas from './Canvas'\nimport getLintErrors from './../utils/getLintErrors'\nimport getErrorLocation from './../utils/getErrorLocation'\n\nconst log = false ? console.log : () => {}\n\n/*\nOutput tells the worker to initialize.\nThe worker then starts the timer.\nThis means that every tick, or every 16.6ms, the timer will run update+draw,\nthen send the ArrayNuffer to Output via postMessage.\nThis will continue forever.\nIf there is an error the worker will send that along as well.\nWhat happens if the worker freezes? Back in Output, every time we get a\nmessage back, we write down when we got it. And every 1s, we check:\nhas it been more than 1 second since we got a postMessage?\nIf yes, then we terminate the worker and start over.\n*/\n\nconst Output = props => {\n  const { cassette } = props\n\n  const canvasRef = useRef()\n  const workerRef = useRef()\n  const pixelBytesRef = useRef()\n  const intervalRef = useRef()\n  const messageReceivedDateRef = useRef()\n  const [codeError, setCodeError] = useState(null)\n  const [isCodeTimedOut, setIsCodeTimedOut] = useState(false)\n  // const [frameDuration, setFrameDuration] = useState(null)\n\n  // This function initializes the web worker. It's run on mount,\n  // and every time we restart the worker.\n  const initWorker = useCallback(() => {\n    console.log('Output: Initializing web worker.')\n\n    // If we already have an interval, stop it.\n    if (intervalRef.current) {\n      log('Output: intervalRef exists. Stopping interval.')\n      intervalRef.current.stop()\n      intervalRef.current = null\n    }\n\n    // Initialize the worker.\n    workerRef.current = new Worker(`${window.location.origin}/js/worker.js`)\n\n    // Handle getting messages from the worker.\n    workerRef.current.onmessage = e => {\n      // Store the timestamp when we got the message.\n      // We'll use this later to see how long it's been\n      // since we last got a message from the worker.\n      messageReceivedDateRef.current = Date.now()\n\n      // Get the data from the worker (thank you worker!)\n      const [messageType, payload] = e.data\n\n      // If the timer doesn't exist, create it.\n      if (!intervalRef.current) {\n        // Every 2 seconds, check: when was the last time\n        // we got a message back from the worker?\n        // Has it been too long?\n        // If so, terminate the worker and initialize it again.\n        log('Output: interval does not exist. Creating interval.')\n        intervalRef.current = interval(() => {\n          if (Date.now() - messageReceivedDateRef.current > 1000) {\n            log('Output: worker is taking too long.')\n            log('Output: restarting web worker.')\n            workerRef.current.terminate()\n            setIsCodeTimedOut(true)\n            initWorker()\n          } else {\n            setIsCodeTimedOut(false)\n          }\n        }, 500)\n      }\n\n      switch (messageType) {\n        // If message is 'draw',\n        // store ArrayBuffer in pixelBytesRef,\n        // and draw it.\n        case 'draw': {\n          log('Output: Received message `draw`.')\n          pixelBytesRef.current = payload\n          canvasRef.current.draw(pixelBytesRef.current)\n          setCodeError(null)\n          break\n        }\n\n        // If message is 'error',\n        // let user know.\n        // Also stop the interval timer. Otherwise we will\n        // think it's been too long, and then\n        // we'll incorrectly restart the worker.\n        case 'error': {\n          log('Output: Received message `error`.')\n\n          log('Output: Stopping interval.')\n          intervalRef.current.stop()\n          intervalRef.current = null\n\n          const location = getErrorLocation(payload)\n          setCodeError({\n            message: payload.message,\n            ...location,\n          })\n          break\n        }\n\n        default: {\n        }\n      }\n    }\n  }, [])\n\n  // On load,\n  // create the worker.\n  useEffect(() => {\n    initWorker()\n  }, [initWorker])\n\n  // When the cassette code changes,\n  useEffect(() => {\n    const code = cassette?.contents?.code\n    // If we have a webworker, code, and no lint errors,\n    // we are ready to send code to the worker.\n    if (workerRef.current && code && !getLintErrors(code).length) {\n      // If the timer doesn't exist, create it.\n      if (!intervalRef.current) {\n        // Every 2 seconds, check: when was the last time\n        // we got a message back from the worker?\n        // Has it been too long?\n        // If so, terminate the worker and initialize it again.\n        log('Output: interval does not exist. Creating interval.')\n        intervalRef.current = interval(() => {\n          if (Date.now() - messageReceivedDateRef.current > 1000) {\n            log('Output: worker is taking too long.')\n            log('Output: restarting web worker.')\n            workerRef.current.terminate()\n            setIsCodeTimedOut(true)\n            initWorker()\n          } else {\n            setIsCodeTimedOut(false)\n          }\n        }, 500)\n      }\n\n      workerRef.current.postMessage(code)\n    }\n  }, [cassette, initWorker])\n\n  return (\n    <div className=\"Output\">\n      <Canvas ref={canvasRef} />\n      <div className=\"messages\">\n        {/* <div className=\"log\">1 frame takes {frameDuration}ms</div> */}\n        {codeError?.message && (\n          <div className=\"error\">Error: {codeError.message}</div>\n        )}\n        {isCodeTimedOut && (\n          <div className=\"error\">\n            Error: code is taking too long. Check for infinite loops.\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n\nexport default Output\n// const intervalCallback = useCallback(() => {\n//   if (Date.now() - messageReceivedDateRef.current > 1000) {\n//     log('Output: worker is taking too long.')\n//     log('Output: restarting web worker.')\n//     workerRef.current.terminate()\n//     setIsCodeTimedOut(true)\n//     initWorker()\n//   } else {\n//     setIsCodeTimedOut(false)\n//   }\n// }, [initWorker])\n","import React from 'react'\nimport Editor from './Editor'\nimport Output from './Output'\nimport Nav from './Nav'\n\nconst Code = props => {\n  return (\n    <div className=\"Code\">\n      <Nav {...props} />\n      <Editor {...props} />\n      <Output {...props} />\n    </div>\n  )\n}\n\nexport default Code\n","import React from 'react'\nimport Nav from './Nav'\nimport Output from './Output'\n\nconst Run = props => {\n  return (\n    <div className=\"Run\">\n      <Nav {...props} />\n      <Output {...props} />\n    </div>\n  )\n}\n\nexport default Run\n","const fetchGithubAppAccessToken = async code => {\n  try {\n    const response = await fetch(\n      `${process.env.REACT_APP_NOW}/api/oauth-comments`,\n      {\n        method: 'POST',\n        body: JSON.stringify({ code }),\n      },\n    )\n    if (response.status === 200) {\n      const json = await response.json()\n      return json\n    } else {\n      throw new Error(`${response.status}: ${response.statusText}`)\n    }\n  } catch (error) {\n    throw error\n  }\n}\n\nconst assembleGistPayload = cassette => ({\n  public: true,\n  description: 'SCRIPT-9',\n  files: {\n    'code.json': {\n      content: cassette.contents.code,\n    },\n  },\n})\n\nconst fetchFavicon = async () => {\n  try {\n    const response = await fetch('/img/favicon.co')\n    if (!response.ok) {\n      throw new Error(response.statusText)\n    }\n    return response\n  } catch (error) {\n    throw error\n  }\n}\n\nconst fetchGist = async gistId => {\n  const url = `https://api.github.com/gists/${gistId}`\n  const response = await fetch(url)\n  if (response.status === 200) {\n    const json = await response.json()\n    return json\n  } else {\n    throw new Error(`${response.status}: ${response.statusText}`)\n  }\n}\n\nconst editGist = async ({ cassette, token }) => {\n  const payload = assembleGistPayload(cassette)\n  const options = {\n    headers: {\n      Authorization: `token ${token}`,\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify(payload),\n  }\n  const id = cassette.gist?.id || cassette.gistId\n  const url = `https://api.github.com/gists/${id}`\n  options.method = 'PATCH'\n  const response = await fetch(url, options)\n  if (response.status === 200) {\n    const json = await response.json()\n    return json\n  } else {\n    throw new Error(`${response.status}: ${response.statusText}`)\n  }\n}\n\nconst createGist = async ({ cassette, token }) => {\n  const payload = assembleGistPayload(cassette)\n  const options = {\n    headers: {\n      Authorization: `token ${token}`,\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify(payload),\n  }\n  const url = `https://api.github.com/gists`\n  options.method = 'POST'\n  const response = await fetch(url, options)\n  if (response.status === 201) {\n    const json = await response.json()\n    return json\n  } else {\n    throw new Error(`${response.status}: ${response.statusText}`)\n  }\n}\n\nconst saveGist = async ({ cassette, token }) => {\n  if (cassette.gist || cassette.gistId) {\n    return await editGist({ cassette, token })\n  } else {\n    return await createGist({ cassette, token })\n  }\n}\n\nexport default { fetchGist, saveGist, fetchFavicon, fetchGithubAppAccessToken }\n","import React, { useEffect } from 'react'\nimport network from '../utils/network'\nimport { navigate } from '@reach/router'\n\nconst Oauth = props => {\n  const { location, setCommentsToken } = props\n\n  useEffect(() => {\n    const { search } = location\n    const params = new window.URLSearchParams(search)\n    const code = params.get('code')\n\n    if (code) {\n      // This means the user clicked login and was redirected here.\n      // We now need to ask for access token.\n      network\n        .fetchGithubAppAccessToken(code)\n        .then(json => {\n          setCommentsToken(json.access_token)\n          navigate('/')\n        })\n        .catch(error => {\n          console.log({ error })\n        })\n    }\n  }, [location, setCommentsToken])\n\n  return (\n    <>\n      <div className=\"Oauth\">\n        <h1>Oauth</h1>\n      </div>\n    </>\n  )\n}\n\nexport default Oauth\n","import React, { useState } from 'react'\nimport { Router } from '@reach/router'\nimport Home from './components/Home'\nimport Code from './components/Code'\nimport Run from './components/Run'\nimport Oauth from './components/Oauth'\n// import useStateWithLocalStorage from './utils/useStateWithLocalStorage'\nimport demoCode from './utils/demoCode'\nimport { version } from './../package.json'\nimport { timestamp } from './utils/timestamp.json'\nimport './styl/App.css'\n\nconst App = () => {\n  // const token = null\n  // const [commentsToken, setCommentsToken] = useStateWithLocalStorage(\n  //   'comments-token',\n  // )\n\n  // Set cassette to demoCode for now.\n  const [cassette, setCassette] = useState({\n    contents: {\n      code: demoCode(),\n    },\n  })\n\n  const props = {\n    timestamp,\n    version,\n    cassette,\n    setCassette,\n    // token,\n    // commentsToken,\n    // setCommentsToken,\n  }\n  return (\n    <>\n      <Router>\n        <Home path=\"/\" {...props} />\n        <Code path=\"/code\" {...props} />\n        <Run path=\"/run\" {...props} />\n        <Oauth path=\"/oauth-comments\" {...props} />\n      </Router>\n    </>\n  )\n}\n\nexport default App\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/,\n    ),\n)\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href)\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config)\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA',\n          )\n        })\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config)\n      }\n    })\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing\n        if (installingWorker == null) {\n          return\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.',\n              )\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration)\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.')\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration)\n              }\n            }\n          }\n        }\n      }\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error)\n    })\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type')\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload()\n          })\n        })\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config)\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.',\n      )\n    })\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister()\n    })\n  }\n}\n","import React from 'react'\nimport { hydrate, render } from 'react-dom'\nimport App from './App'\nimport * as serviceWorker from './serviceWorker'\n\nconst rootElement = document.getElementById('root')\nif (rootElement.hasChildNodes()) {\n  hydrate(<App />, rootElement)\n} else {\n  render(<App />, rootElement)\n}\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.register()\n"],"sourceRoot":""}